{
  "arcs": [
    {
      "direction": "IN",
      "expression": "query",
      "id": "e-fxz84",
      "multiplicity": 1,
      "sourceId": "pStock",
      "targetId": "tSpot"
    },
    {
      "direction": "OUT",
      "expression": "tool_result",
      "id": "aRes",
      "multiplicity": 1,
      "sourceId": "tSpot",
      "targetId": "pYf"
    },
    {
      "direction": "IN",
      "expression": "token",
      "id": "aIRfq",
      "multiplicity": 1,
      "sourceId": "pInitRFQ",
      "targetId": "tRFQInput"
    },
    {
      "direction": "OUT",
      "expression": "aRfq",
      "id": "aRfq",
      "multiplicity": 1,
      "sourceId": "tRFQInput",
      "targetId": "pRFQ"
    },
    {
      "direction": "IN",
      "expression": "token",
      "id": "aOSpot",
      "multiplicity": 1,
      "sourceId": "pYf",
      "targetId": "tAI"
    },
    {
      "direction": "IN",
      "expression": "token",
      "id": "aORfq",
      "multiplicity": 1,
      "sourceId": "pRFQ",
      "targetId": "tAI"
    },
    {
      "direction": "OUT",
      "expression": "func A_aAI_expr(aORfq map[string]interface{}, answer string) interface{} {\n    if aORfq == nil {\n        aORfq = make(map[string]interface{})\n    }\n    aORfq[\"AIOpinion\"] = answer\n    return aORfq\n}",
      "id": "aAI",
      "multiplicity": 1,
      "sourceId": "tAI",
      "targetId": "pAI"
    },
    {
      "direction": "IN",
      "expression": "token",
      "id": "aAIRfq",
      "multiplicity": 1,
      "sourceId": "pAI",
      "targetId": "tPrice"
    },
    {
      "direction": "OUT",
      "expression": "quote",
      "id": "aPx",
      "multiplicity": 1,
      "sourceId": "tPrice",
      "targetId": "p-9udxf"
    }
  ],
  "colorSets": [
    "colset STR = string;",
    "colset J = json;",
    "colset REAL = real;",
    "colset INT = int;",
    "colset RFQ = json;",
    "colset Quote = json;",
    "colset Order = json;",
    "colset RFQ = json<RFQ>;",
    "colset STRING = string;",
    "colset JSON = string;",
    "colset MARKDOWN = string;",
    "colset AnyData = json;",
    "colset OrderTyped = json<OrderSchema>;",
    "colset Product = json<ProductSchema>;",
    "colset Status = string;",
    "colset Amount = int;"
  ],
  "currentStep": 0,
  "description": "",
  "globalClock": 0,
  "id": "Trade",
  "initialMarking": {
    "pInitRFQ": [
      {
        "timestamp": 0,
        "value": {
          "KOLevel": 130,
          "Maturity": 30,
          "PathNum": 1000,
          "Rate": 0.03,
          "ReqID": "REQ-001",
          "Spot": 100,
          "Strike": 105,
          "Underlying": "AAPL",
          "Vol": 0.2
        }
      }
    ],
    "pStock": [
      {
        "timestamp": 0,
        "value": {
          "symbol": [
            "AAPL"
          ]
        }
      }
    ]
  },
  "jsonSchemas": [
    {
      "name": "OrderSchema",
      "schema": {
        "properties": {
          "customerId": {
            "description": "Customer identifier",
            "type": "string"
          },
          "items": {
            "description": "Order items",
            "items": {
              "properties": {
                "price": {
                  "type": "number"
                },
                "productId": {
                  "type": "string"
                },
                "quantity": {
                  "type": "integer"
                }
              },
              "type": "object"
            },
            "type": "array"
          },
          "orderId": {
            "description": "Unique order identifier",
            "type": "string"
          },
          "status": {
            "enum": [
              "pending",
              "processing",
              "completed",
              "cancelled"
            ],
            "type": "string"
          },
          "total": {
            "description": "Order total amount",
            "type": "number"
          }
        },
        "required": [
          "orderId",
          "customerId",
          "total"
        ],
        "type": "object"
      }
    },
    {
      "name": "ProductSchema",
      "schema": {
        "properties": {
          "price": {
            "type": "number"
          },
          "productId": {
            "type": "string"
          }
        },
        "required": [
          "productId",
          "price"
        ],
        "type": "object"
      }
    },
    {
      "name": "RFQ",
      "schema": {
        "$schema": "https://json-schema.org/draft-07/schema",
        "description": "Generated from JSON data",
        "properties": {
          "KOLevel": {
            "type": "integer"
          },
          "Maturity": {
            "type": "integer"
          },
          "PathNum": {
            "type": "integer"
          },
          "Rate": {
            "type": "number"
          },
          "ReqID": {
            "type": "string"
          },
          "Spot": {
            "type": "integer"
          },
          "Strike": {
            "type": "integer"
          },
          "Underlying": {
            "type": "string"
          },
          "Vol": {
            "type": "number"
          }
        },
        "required": [
          "KOLevel",
          "Maturity",
          "PathNum",
          "Rate",
          "ReqID",
          "Spot",
          "Strike",
          "Underlying",
          "Vol"
        ],
        "title": "Generated Schema",
        "type": "object"
      }
    },
    {
      "name": "Order",
      "schema": {
        "$schema": "https://json-schema.org/draft-07/schema",
        "description": "Generated from JSON data",
        "properties": {
          "AIOpinion": {
            "description": "",
            "type": "string"
          },
          "Amount": {
            "description": "",
            "type": "number"
          },
          "KOLevel": {
            "type": "integer"
          },
          "Maturity": {
            "type": "integer"
          },
          "Rate": {
            "type": "number"
          },
          "Spot": {
            "type": "integer"
          },
          "Strike": {
            "type": "integer"
          },
          "Underlying": {
            "type": "string"
          },
          "Vol": {
            "type": "number"
          }
        },
        "required": [
          "KOLevel",
          "Maturity",
          "Rate",
          "Spot",
          "Strike",
          "Underlying",
          "Vol"
        ],
        "title": "Generated Schema",
        "type": "object"
      }
    }
  ],
  "places": [
    {
      "colorSet": "J",
      "id": "pStock",
      "position": {
        "x": 120,
        "y": 72.804474
      }
    },
    {
      "colorSet": "J",
      "id": "pYf",
      "position": {
        "x": 640,
        "y": 80
      }
    },
    {
      "colorSet": "J",
      "id": "pInitRFQ",
      "position": {
        "x": 117.64002,
        "y": 204.71996
      }
    },
    {
      "colorSet": "J",
      "id": "pRFQ",
      "position": {
        "x": 549.4166,
        "y": 193.66667
      }
    },
    {
      "colorSet": "J",
      "id": "pAI",
      "position": {
        "x": 1124.1484,
        "y": 137.4828
      }
    },
    {
      "colorSet": "J",
      "id": "p-9udxf",
      "position": {
        "x": 469.57593,
        "y": 349.27698
      }
    }
  ],
  "status": "loaded",
  "subWorkflows": [
    {
      "autoStart": true,
      "callTransitionId": "tPrice",
      "cpnId": "5.Scripting",
      "id": "sw_tPrice",
      "inputMapping": {
        "aAIRfq": "rfq"
      },
      "outputMapping": {
        "premium": "premium"
      },
      "propagateOnComplete": true
    }
  ],
  "transitions": [
    {
      "Tools": [
        {
          "name": "mcp:https://data.lizhao.net/api/mcp:yahoo_quote"
        }
      ],
      "guardExpression": "true",
      "id": "tSpot",
      "kind": "Tools",
      "position": {
        "x": 324.5,
        "y": 97
      }
    },
    {
      "actionFunction": "func T_tRFQInput_action(aIRfq map[string]interface{},  formData map[string]interface{}) map[string]interface{} {\n    base := make(map[string]interface{})\n    if aIRfq != nil {\n        for k, v := range aIRfq {\n            base[k] = v\n        }\n    }\n    if formData != nil {\n        for k, v := range formData {\n            base[k] = v\n        }\n    }\n    return base\n  \n}",
      "guardExpression": "true",
      "id": "tRFQInput",
      "kind": "Manual",
      "position": {
        "x": 258.12268,
        "y": 222.81293
      }
    },
    {
      "LlmOptions": {},
      "LlmTemplate": {
        "messages": [
          {
            "text": "You are an experienced financial adviser specializing in listed equity option trading. Provide a concise qualitative opinion (bullish / neutral / cautious) and one short rationale.",
            "type": "system"
          },
          {
            "text": "Based on current market environment, is the following option good to buy?\n{{aORfq}}, especially give comment on current spot price info at {{aOSpot}}",
            "type": "user"
          }
        ]
      },
      "guardExpression": "true",
      "id": "tAI",
      "kind": "LLM",
      "position": {
        "x": 794.25464,
        "y": 161.63455
      }
    },
    {
      "actionFunction": "func T_tPrice_action(aAIRfq map[string]interface{}, premium interface{}) map[string]interface{} {\n    if premium != nil {\n        aAIRfq[\"Premium\"] = premium\n    }\n    return aAIRfq\n}",
      "actionFunctionOutput": [
        "quote"
      ],
      "guardExpression": "true",
      "id": "tPrice",
      "kind": "Auto",
      "position": {
        "x": 162.59732,
        "y": 365.9455
      }
    }
  ]
}